sap.ui.define(["sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Context","jquery.sap.global"],function(e,t,n,jQuery){"use strict";return{onInit:function(){console.log("Pezze controller initialized");const e="manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::table::to_ZZ1_CombPlnOrdersStock::LineItem::Stock-innerTable";const t=sap.ui.getCore().byId(e);t.setGrowing(false);t.attachItemPress(function(e){console.log("Item pressed:",e)},this);t.attachSelectionChange(function(e){console.log("Selection changed:",e);const t="manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::table::to_ZZ1_CombPlnOrdersStock::LineItem::Stock-innerTable";const n=sap.ui.getCore().byId(t);e.preventDefault();const o=e.getParameter("listItem");const s=o.getHighlight();if(s==="Error"){setTimeout(()=>{n.removeSelections();const e=n.getBinding("items");if(e&&e.getContexts){n.setSelectedItem(null)}sap.m.MessageToast.show("Item not selectable")},0)}},this);t.attachUpdateFinished(function(e){console.log("Update finished:",e);const t=e.getParameter("id");const n=sap.ui.getCore().byId(t);const o=n.getItems();o.forEach(e=>{const t=e.getBindingContext().getObject();const{AvaibilityQty:n,CombPlanAllQty:o}=t;let s="Success";let r="Stock available";if(parseFloat(n)===0&&parseFloat(o)===0){s="Error";r="No stock available"}else if(parseFloat(n)>0&&parseFloat(o)===0){s="None";r=""}e.setHighlight(s);e.setHighlightText(r)})},this)},onAfterRendering:function(){console.log("Pezze controller after rendering")},showMessageConfirm:function(e){e=e.charAt(0).toUpperCase()+e.slice(1);return new Promise((n,o)=>t.confirm("Are you sure you want to "+e+"?",{title:"Confirmation",onClose:function(e){if(e===t.Action.OK)n();else o()}}))},doAssign:function(t){const n=this.getOwnerComponent().getModel();const o=sap.ui.getCore().byId("fragmentPezze--selectedItemsTable");const s=o.getBinding("items");this.showMessageConfirm("assign").then(function(){e.show("Do Assemble invoked.");n.submitBatch("CreatePezzeBatch").then((t,n,o)=>{const s=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::table::to_ZZ1_CombPlnOrdersStock::LineItem::Stock-innerTable");e.show("Do Assemble completed.");sap.ui.getCore().byId("fragmentPezze--_IDGenDialogPezze").close();s.refreshItems();s.getBinding("items").refresh();s.removeSelections();const r=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::HeaderFacet::KeyFigure::TotalProdAllQty");r.getBindingContext().refresh()}).catch((t,n,o)=>{e.show("Do Assemble error.");console.error("Error",t)})}.bind(this)).catch(t=>{e.show("Do Assemble cancelled. "+JSON.stringify(t))})},onCloseDialog:function(e){const t=e.getSource().getParent();t.close()},formatAvailableQty:function(e){if(!e)return 0;return parseInt(e)},formatCustomQty:function(e){return parseInt(e)},formatAvaibilityQty:function(e){debugger;return e},onBeforeRebindTable:function(e){},onDesassembly:function(){const t="fragmentPezze--selectedItemsTableWhereUsed";const n=sap.ui.getCore().byId(t).getSelectedItems();const o=this.getOwnerComponent().getModel();const s=this.getView().getModel("selectedWhereUsed");const r=s.getProperty("/CplndOrd");const a=[];a.push({id:"1",fsh_cplnd_ord:r,flag:false});n.forEach(e=>{const t=e.getBindingContext();if(t){a.push({id:"1",fsh_cplnd_ord:t.getProperty("CplndOrd"),flag:true})}});const i={id:"1",atpplo:a};this.showMessageConfirm("process ATP").then(()=>{const t=o.sServiceUrl;debugger;jQuery.ajax({url:t+"atpPlo",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({Payload:i}),headers:{Accept:"application/json","Content-Type":"application/json"},success:function(){debugger;e.show("ATP Process completed successfully");sap.ui.getCore().byId("fragmentPezze--_IDGenDialogWhereUsed").close();const t=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::table::to_ZZ1_CombPlnOrdersStock::LineItem::Stock-innerTable");t.refreshItems();t.getBinding("items").refresh();const n=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPI_to_CombinPlannedOrdersComObjectPage--fe::HeaderFacet::KeyFigure::TotalProdAllQty");n.getBindingContext().refresh()},error:function(t,n,o){debugger;e.show("ATP Process failed");console.error("Error in ATP Process:",n,o)}})}).catch(()=>{e.show("ATP Process cancelled")})}}});
//# sourceMappingURL=Pezze.controller.js.map