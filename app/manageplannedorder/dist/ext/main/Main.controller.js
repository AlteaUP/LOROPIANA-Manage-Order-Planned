sap.ui.define(["sap/fe/core/PageController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/BusyIndicator"],function(e,n,t,o,r,a,s){"use strict";return e.extend("manageplannedorder.manageplannedorder.ext.main.Main",{onInit:function(){},showMessageConfirm:function(e){e=e.charAt(0).toUpperCase()+e.slice(1);return new Promise((n,t)=>r.confirm("Are you sure you want to "+e+"?",{title:"Confirmation",onClose:function(e){if(e===r.Action.OK)n();else t()}}))},pressFragment:function(e){const r=e.getParameter("id").split("::").slice(0,-2).join("::");const s=sap.ui.getCore().byId(r)._oTable;const i=s.getSelectedItems();if(i.length===0){a.show("Select at least one item");return}const d=this.getOwnerComponent().getModel();const l=[];for(let e=0;e<i.length;e++){const n=i[e].getBindingContext().getObject();l.push(n)}const c=new n;c.setData({TypeOrder:"Z300",selectedItems:l});if(!this._fragmentConvert){this._fragmentConvert=this.loadFragment({id:"fragmentPezze",name:"manageplannedorder.manageplannedorder.ext.fragment.Converti",controller:this})}this._fragmentConvert.then(function(e){e.setModel(c,"selected");e.setModel(d);const n=e.getContent().at(-1);const r=[];l.forEach(e=>{if(!e)return;const n=new t("FSH_CPLND_ORD",o.EQ,e.CplndOrd);r.push(n)});n.bindAggregation("items",{path:"/ConvertPLO",filters:r,template:new sap.m.ColumnListItem({cells:[new sap.m.ObjectIdentifier({title:"{FSH_CPLND_ORD}"}),new sap.m.ObjectIdentifier({title:"{CrossPlantConfigurableProduct}"}),new sap.m.Text({text:"{AUART}"}),new sap.m.Input({value:"{TOT_QTY}"}),new sap.m.ObjectIdentifier({title:"{PlannedTotalQtyInBaseUnit}"}),new sap.m.Text({text:"{UNIT}"})]}),parameters:{$$updateGroupId:"CreateConvertPLO"}});const a=n.getBinding("items");a.resetChanges();l.forEach(e=>{a.create({FSH_CPLND_ORD:e.CplndOrd,AUART:"Z300",TOT_QTY:e.PlndOrderCommittedQty.toString(),UNIT:"EA",PlannedTotalQtyInBaseUnit:e.PlannedTotalQtyInBaseUnit,CrossPlantConfigurableProduct:e.CrossPlantConfigurableProduct})});e.attachEventOnce("afterOpen",function(){const e=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPIMain--fragmentPezze--inputTypeOrder");if(e){e.focus();e.attachLiveChange(this.onTypeOrderLiveChange.bind(this))}}.bind(this));e.open()}.bind(this))},onCloseDialog:function(e){const n=e.getSource().getParent();n.close()},doConvert:function(e){const n=this.getOwnerComponent().getModel();const t=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPIMain--TableCombined-content");const o=t._oTable.getBinding("items");this.showMessageConfirm("convert").then(function(){a.show("Do Convert invoked.");s.show(0);debugger;n.submitBatch("CreateConvertPLO").then(function(e){console.log("Convert response",e);a.show("Do Convert completed.");sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPIMain--fragmentPezze--_IDGenDialogConversion").close();s.hide();o.refresh()}.bind(this)).catch(e=>{a.show("Do Convert error.");console.error("Error",e);s.hide()})}.bind(this)).catch(e=>{a.show("Do Convert cancelled. "+JSON.stringify(e))})},formattaQty:function(e){console.log(e);const n=e.replace(",",".");return n},onTypeOrderLiveChange:function(e){console.log("onTypeOrderLiveChange",e);const n=sap.ui.getCore().byId("manageplannedorder.manageplannedorder::ZZ1_CombinedPlnOrdersAPIMain--fragmentPezze--selectedItemsTableCombined");const t=n.getBinding("items");const o=e.getParameter("value");t.getContexts().forEach(function(e){if(e){e.setProperty("AUART",o)}})},onRowPress:function(e){}})});
//# sourceMappingURL=Main.controller.js.map